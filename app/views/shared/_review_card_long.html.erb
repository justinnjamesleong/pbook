<div>
<%flavors=[]%>
<%reviews=@dish.reviews.reverse%>
<div class="d-flex flex-column gap-2" >
    <div class="pt-4">
    <h4>Reviews</h4>
    </div>
  <div class="sidefoodcards d-flex flex-grow" data-reviewmodal-target="lists">
    <%# div holds everything else APART from picture %>
    <%# pl-2 py-4 pr-4 %>
    <% reviews.each do |review| %>
    <div>
    <div class="sidefood-content" style="flex-grow:inherit" >
      <%# <div class="d-flex justify-content-between"> %>
       <% if @dish.reviews.blank? %>
           Be the first to leave a review for <%= @dish.name %>
      <%# </div> %>
        <% else %>
          <%# rank %>
          <div class="rank-text"  style="font-size:16px;"> <%# my-1 %>

           <%# stall name %>

          <%# name of dish %>
            <p class="text-justify" style="font-size:14px; inline">
            <strong><%=review.user.username%></strong>    @: <%t=review.created_at%><%=t.getlocal.strftime("%Y-%d-%m %H:%M:%S")%></p>
            </p>
          </div>
              <%# div holding flavours and stars %>
          <div class='d-flex justify-content-between align-items-center flex-wrap'>
            <div style="list-style-type: none" class="d-flex flex-row justify-content-left">
              <div style="list-style-type: none font-size:14px;" class="mx-auto d-flex gap-3">
                <% if review.review_flavors != {} %>
                  <%review.review_flavors.each do |review_flavor|%>
                    <%flavors<<review_flavor.flavor.name%>
                 <%end%>
                <%flavor_count = Hash.new(0)%>
                <%# added new line %>
                <%flavors.each {|flavor| flavor_count[flavor] += 1}%>
                <%# sort each flavors by number of review and map just the flavors, takes the top 3 %>
                <% flavors = flavor_count.sort_by { |flavor,number| number}.reverse.map{|flavor| flavor[0]}[0..2] %>
                <%# print out the 3 top flavors %>
                <% flavors.each do |foodflavor| %>
                    <span class="pink-badge"><%=foodflavor%></span>



                <%# end of added new line %>
                <%# causing error if theres no 3x food flavor%>
                <%# entire line wont be printed as its always false %>
                  <%end%>
              </div>

            </div>
            <div class="stars-rank p-1">
              <%review.rating.to_i.times do%>
                <i class="fa-solid fa-star" style="color:gold;"></i>
              <%end%>
              <%left_overstars= 5-review.rating.to_i%>
              <%left_overstars.times do%>
                <i class="fa-light fa-star"></i>
              <%end%>
            </div>
          </div>
          <%# dish description %>
      <div class="text-justify">
        <p class="my-2" style="margin-left:5px;font-size:12px;">
          <%=review.comment[0..200] %>
        </p>
        <% end %>

    </div>
    </div>
     <% end %>
     <% end %>
  </div>
</div>
</div>
